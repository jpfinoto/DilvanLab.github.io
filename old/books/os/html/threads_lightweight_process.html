<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>2.&nbsp;Lightweight Process</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.67.0"><link rel="start" href="index.html" title="Operating Systems"><link rel="up" href="threads.html" title="Chapter&nbsp;3.&nbsp;Threads"><link rel="prev" href="threads_introduction.html" title="1.&nbsp;Introduction"><link rel="next" href="threads_scheduling.html" title="3.&nbsp;Scheduling"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.&nbsp;Lightweight Process</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="threads_introduction.html"><img src="images/prev.gif" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Threads</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="threads_scheduling.html"><img src="images/next.gif" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="threads_lightweight_process"></a>2.&nbsp;Lightweight Process</h2></div></div></div><p><span class="bold"><strong>Definition:</strong></span></p><p>Threads are implemented by a library that utilizes underlying kernel-supported threads of control, called light-weight processes (LWPs).</p><p>Each LWP can be thought of as a virtual CPU which is available for executing code or system calls. Each LWP:</p><div class="itemizedlist"><ul type="disc"><li><p>is separately dispatched by the kernel.</p></li><li><p>may perform independent system calls.</p></li><li><p>incur independent page faults.</p></li><li><p>may run in parallel on a multiprocessor.</p></li></ul></div><p><span class="bold"><strong>Note:</strong></span> Most programmers use threads without thinking about LWPs.</p><div class="figure"><a name="d0e1718"></a><p class="title"><b>Figure&nbsp;3.2.&nbsp;Solaris LWPs</b></p><div class="mediaobject"><img src="resources/Parallel5.gif" alt="Solaris LWPs"></div></div><div class="itemizedlist"><ul type="disc"><li><p>Mapping threads to LWPs</p><p>All the LWPs in the system are scheduled by the kernel onto the available CPUs according to their scheduling class and priority.</p><div class="itemizedlist"><ul type="circle"><li><p>Each process contains one or more LWPs, each of which runs one or more user threads.</p></li><li><p>There is no one-to-one mapping between user threads and LWPs.</p></li><li><p>User-level unbound threads can freely migrate from one LWP to another.</p></li><li><p>If there are available processors, the LWPs run in parallel.</p></li><li><p>The OS has no knowledge about what user threads are or how many are active in each process.</p></li></ul></div><p><span class="bold"><strong>Unbound Threads:</strong></span></p><p>Threads that are scheduled on the LWP pool are called unbound threads. They float among the LWPs.</p><div class="itemizedlist"><ul type="circle"><li><p>The library invokes LWPs as needed and assigns them to execute runnable threads.</p></li><li><p>The LWP assumes the state of the thread and executes its instructions.</p></li><li><p>If another thread should be run, the thread state is saved in process memory and the threads library assigns another thread to the LWP.</p></li></ul></div><p><span class="bold"><strong>Bound Threads:</strong></span></p><p>If needed, a thread can be permanently bonded to an LWP.</p><p>For example, you can bind a thread to:</p><div class="itemizedlist"><ul type="circle"><li><p>Have the thread scheduled globally (such as realtime)</p></li><li><p>Give the thread an alternate signal stack</p></li><li><p>Give the thread a unique alarm or timer</p></li></ul></div></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>Threads Library Implementation</p><p>Each thread is represented by a thread structure that contains:</p><div class="itemizedlist"><ul type="circle"><li><p>The thread ID.</p></li><li><p>An area to save the thread execution context.</p></li><li><p>The thread signal mask</p></li><li><p>The thread priority</p></li><li><p>A pointer to the thread stack.</p></li></ul></div><p>The storage for the stack is either automatically allocated by the library or it is passed in by the application on thread creation</p><p>When a thread is created, a thread ID is assigned. The thread ID is used as an index in a table of pointers to thread structures.</p><p><span class="bold"><strong>Thread-local Storage:</strong></span></p><p>Threads have some private storage (in addition to the stack) called thread-local storage (TLS).</p><p>Most variables in the program are shared among all the threads executing it, but each thread has its own copy of thread-local variables.</p><p>Conceptually, thread-local storage is</p><div class="itemizedlist"><ul type="circle"><li><p>Unshared.</p></li><li><p>Statically allocated data.</p></li><li><p>Used for thread-private data that must be accessed quickly.</p></li></ul></div></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="threads_introduction.html"><img src="images/prev.gif" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="threads.html"><img src="images/up.gif" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="threads_scheduling.html"><img src="images/next.gif" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">1.&nbsp;Introduction&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.gif" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;3.&nbsp;Scheduling</td></tr></table></div></body></html>