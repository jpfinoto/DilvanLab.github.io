<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>3.&nbsp;NFS - Network File System</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.67.0"><link rel="start" href="index.html" title="Operating Systems"><link rel="up" href="nos_network_operating_systems.html" title="Chapter&nbsp;6.&nbsp;Network Operating Systems"><link rel="prev" href="nos_network_operating_systems_dns_domain_name_server.html" title="2.&nbsp;DNS - Domain Name Server"><link rel="next" href="nos_network_operating_systems_nis-network_information_system.html" title="4.&nbsp;NIS - Network Information System"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.&nbsp;NFS - Network File System</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="nos_network_operating_systems_dns_domain_name_server.html"><img src="images/prev.gif" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;6.&nbsp;Network Operating Systems</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="nos_network_operating_systems_nis-network_information_system.html"><img src="images/next.gif" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="nos_network_operating_systems_nfs_network_file_system"></a>3.&nbsp;NFS - Network File System</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The Network File System</p><p>NFS allows to access files on remote hosts in exactly the same way as a user would access any local files.</p><p><span class="bold"><strong>Advantages:</strong></span></p><div class="itemizedlist"><ul type="circle"><li><p>Data accessed by all users can be kept on a central host, with clients mounting this directory at boot time.</p></li><li><p>Data consuming large amounts of disk space may be kept on a single host.</p></li><li><p>Administrative data may be kept on a single host.</p></li></ul></div><p><span class="bold"><strong>Architecture:</strong></span></p><div class="itemizedlist"><ul type="circle"><li><p>A collection of clients and servers can share a file system.</p></li><li><p>A machine can be at the same time a NFS client and a NFS server.</p></li><li><p>A server makes a directory available to clients by exporting it.</p></li><li><p>Clients can access remote file system by mounting then through a NFS.</p></li><li><p>A diskless client can mount a remote file system as its root directory, making a completely remote file system.</p></li><li><p>NFS was invented by Sun Microsystems and adopted by all other Unix vendors.</p></li><li><p>NFS is the most important networking service using RPCs.</p></li></ul></div><p><span class="bold"><strong>Mounting directories:</strong></span></p><p>A client can mount the directories and files from the file server anywhere in its file system, and use then in the same way as local files.</p><pre class="programlisting">mount -t nfs oca:/games /games</pre></li><li><p><span class="bold"><strong>File Sharing</strong></span></p><p>Two or more clients can mount and share the same files from the file server. They can even mount then in different places:</p><div class="figure"><a name="d0e3780"></a><p class="title"><b>Figure&nbsp;6.2.&nbsp;File Sharing</b></p><div class="mediaobject"><img src="resources/Nos2.gif" alt="File Sharing"></div></div><p>Client 1:</p><pre class="programlisting">mount -t nfs oca:/games /games
mount -t nfs oca:/work /work</pre><p>Client 2:</p><pre class="programlisting">mount -t nfs oca:/games /games
mount -t nfs oca:/work /games/work</pre><div class="figure"><a name="d0e3794"></a><p class="title"><b>Figure&nbsp;6.3.&nbsp;Mount Example</b></p><div class="mediaobject"><img src="resources/Nos3.gif" alt="Mount Example"></div></div></li><li><p><span class="bold"><strong>NFS Daemons</strong></span></p><p>To provide NFS service to other hosts, you have to run the RPC-based daemons:</p><div class="itemizedlist"><ul type="circle"><li><p>nfsd - Provide the file services.</p></li><li><p>mountd - Provides the mounting services.</p></li></ul></div><p><span class="bold"><strong>NFS Protocols:</strong></span></p><p>NFS uses two protocols:</p><div class="itemizedlist"><ul type="circle"><li><p>For mounting (using mountd).</p></li><li><p>For accessing directories and files (using nfsd).</p></li></ul></div><p><span class="bold"><strong>Mounting directories:</strong></span></p><div class="orderedlist"><ol type="1"><li><p>A client may request to mount a directory from a remote host on a local directory just the same way it can mount a physical device:</p><pre class="programlisting">mount -t nfs oca:/home/tcl /users</pre></li><li><p>mount will then try to connect to the mountd mount daemon on oca via RPC.</p></li><li><p>The server will check if vale is permitted to mount the directory in question, and if so, return it a file handle.</p></li><li><p>This file handle will be used in all subsequent requests to files below /users.</p><p>The file handle holds:</p><div class="orderedlist"><ol type="a"><li><p>The file system type.</p></li><li><p>The directory disk.</p></li><li><p>The directory i-node.</p></li><li><p>Security information.</p></li></ol></div><p>Directories are generally mounted during boot time using the /etc/rc script.</p></li></ol></div><p><span class="bold"><strong>Accessing files and directories</strong></span></p><p>When a file is accessed over NFS, the kernel places an RPC call to nfsd daemon on the server machine.</p><p><span class="bold"><strong>Commands to change directory entries:</strong></span></p><div class="itemizedlist"><ul type="circle"><li><p>read.</p></li><li><p>write.</p></li><li><p>access attributes:</p><div class="itemizedlist"><ul type="disc"><li><p>mode</p></li><li><p>size</p></li><li><p>time of last modification</p></li></ul></div></li></ul></div><p><span class="bold"><strong>Commands to change files:</strong></span></p><div class="itemizedlist"><ul type="circle"><li><p>lookup</p><p>Client sends file name and gets file handle.</p></li><li><p>read</p><p>To get the data, the client sends:</p><div class="itemizedlist"><ul type="disc"><li><p>File handle.</p></li><li><p>Offset to read point.</p></li><li><p>Number of bytes.</p></li></ul></div></li><li><p>write</p><p>Similar to read.</p></li></ul></div><p><span class="bold"><strong>Note:</strong></span></p><p>The NFS servers don't keep any information about the status of client operations. When a RPC call finishes all the information about its status disappears. For this reason the server does not open or closes files, it just read or write peaces of them. NFS servers are <span class="bold"><strong>stateless</strong></span>.</p></li><li><p><span class="bold"><strong>Virtual File System</strong></span></p><p>The virtual file system (VFS) layer of the OS keeps the information, at the client's side, about the NFS operations.</p><p><span class="bold"><strong>Mount operation:</strong></span></p><div class="orderedlist"><ol type="1"><li><p>The mount programs receives the remote directory (host name + path) and local directories.</p></li><li><p>It finds the correct machine.</p></li><li><p>It gets from the NFS servers a file handle for the directory.</p></li><li><p>It does a mount system call.</p></li><li><p>The kernel makes a v-node for the remote directory.</p></li><li><p>The NFS client makes a r-node to save the file handle (the v-node points to the r-node).</p></li></ol></div><p><span class="bold"><strong>File operation:</strong></span></p><div class="orderedlist"><ol type="1"><li><p>The kernel finds the r-node (through the v-node).</p></li><li><p>It asks the NFS client to open the file.</p></li><li><p>The NFS client gets the file handle for the remote directory.</p></li><li><p>It asks the NFS server for a file handle to the file and makes a r-node for it.</p></li><li><p>It sends the r-node to the VFS.</p></li><li><p>The VFS makes a v-node for the r-node.</p></li><li><p>The program that asked to open the file receives a file descriptor (fd) for the remote file. This fd points to the v-node.</p></li></ol></div><p>When the fd is used in a system call (read(), for instance), the VFS finds the v-node and finds out if the file is local (it uses a i-node) or is remote (it uses a r-node).</p></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="nos_network_operating_systems_dns_domain_name_server.html"><img src="images/prev.gif" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="nos_network_operating_systems.html"><img src="images/up.gif" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="nos_network_operating_systems_nis-network_information_system.html"><img src="images/next.gif" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">2.&nbsp;DNS - Domain Name Server&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.gif" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;4.&nbsp;NIS - Network Information System</td></tr></table></div></body></html>